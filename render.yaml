# =====================================================
# Render Deployment Configuration ‚Äì Football Prediction API
# =====================================================

services:
  - type: web
    name: previsao-futebol
    env: python
    plan: free
    region: frankfurt

    buildCommand: |
      pip install --upgrade pip
      pip install -r requirements.txt

    startCommand: uvicorn src.main:api --host 0.0.0.0 --port $PORT

    healthCheckPath: /healthz
    autoDeploy: true

    envVars:
      - key: PYTHON_VERSION
        value: 3.11.0

      - key: ENV
        value: production
      - key: MODE
        value: api

      - key: PREDICTIONS_PATH
        value: data/predict/predictions.json

      # üîÄ Toggle do v2 (podes come√ßar em "false" e ligar depois por API)
      - key: V2_MODELS_ENABLED
        value: "false"
      # ‚ö†Ô∏è Circuit breaker (opcional)
      - key: V2_FAIL_MAX
        value: "5"
      - key: V2_FAIL_TTL
        value: "900"

      # üîí Segredos (ajusta os nomes aos teus Secrets no Render)
      - key: API_TOKEN
        fromSecret: API_TOKEN
      - key: REDIS_URL
        fromSecret: REDIS_URL
      - key: TELEGRAM_TOKEN
        fromSecret: TELEGRAM_TOKEN
      - key: CHAT_ID
        fromSecret: CHAT_ID
